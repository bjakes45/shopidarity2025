<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>{% block title %}Shopidarity{% endblock %}</title>
	<link rel="shortcut icon" href="/static/shopidarity_favicon.ico" type="image/x-icon" />

	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
	<!-- Tailwind CSS -->
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.awesome-markers@2.0.4/dist/leaflet.awesome-markers.css" />
	<!-- Font Awesome 4.7.0 (required for icons in AwesomeMarkers) -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
	<script src="https://cdn.jsdelivr.net/npm/leaflet.awesome-markers@2.0.4/dist/leaflet.awesome-markers.min.js"></script>


</head>

<body>
	{% with messages = get_flashed_messages(with_categories=true) %}
	{% if messages %}
	<div id="flash-messages" class="space-y-2">
		{% for category, message in messages %}
		<div class="relative p-4 rounded text-sm text-white
		{% if category == 'error' %} bg-red-600
		{% elif category == 'success' %} bg-green-600
		{% else %} bg-blue-600 {% endif %}">
		<span>{{ message }}</span>
		<button type="button" onclick="this.parentElement.remove()"
		class="absolute top-1 right-2 text-white hover:text-gray-200">
		&times;
	</button>
</div>
{% endfor %}
</div>
{% endif %}
{% endwith %}


<nav class="bg-gray-800 text-white px-4 sm:px-6 md:px-8 py-4">
  <!-- Top row: Logo and Hamburger (mobile) -->
  <div class="flex items-center justify-between md:hidden">
    <div class="text-xl font-bold">
      <a href="{{ url_for('home') }}">SHOPIDARITY</a>
    </div>
    <button id="menu-toggle" class="focus:outline-none">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
           xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>

  <!-- Full nav content -->
  <div id="menu" class="mt-2 space-y-2 md:mt-0 md:flex md:items-center md:justify-between md:space-y-0 hidden md:flex">
    
    <!-- Logo and Left nav links -->
    <div class="flex flex-col md:flex-row md:items-center md:space-x-4">
      <a href="{{ url_for('home') }}" class="text-xl font-bold">SHOPIDARITY</a>
      <a href="{{ url_for('products') }}" class="hover:underline">Products</a>
      <a href="{{ url_for('scan') }}" class="hover:underline">Scan</a>
      <a href="{{ url_for('discover') }}" class="hover:underline">Discover</a>
      <a href="{{ url_for('faq') }}" class="hover:underline">FAQ</a>
    </div>

    <!-- Right user/login section -->
    <div class="flex flex-col md:flex-row md:items-center md:space-x-4 mt-2 md:mt-0">
      {% if current_user.is_authenticated %}
        <span class="block md:inline">Hello, 
          <a href="{{ url_for('dashboard') }}" class="underline">{{ current_user.username }}</a>!
        </span>
        <a href="{{ url_for('logout') }}" class="bg-red-500 px-3 py-1 rounded hover:bg-red-600">Logout</a>
      {% else %}
        <a href="{{ url_for('login') }}" class="bg-blue-500 px-3 py-1 rounded hover:bg-blue-600">Login</a>
      {% endif %}
    </div>
  </div>
</nav>


<div class="content">
	{% block content %}{% endblock %}
</div>

<script>
	setTimeout(() => {
		document.querySelectorAll('#flash-messages > div').forEach(el => el.remove());
	  }, 5000); // hides after 5 seconds
	</script>
	<script>
		function updateLocation() {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(
					position => {
						fetch("/update-location", {
							method: "POST",
							headers: {
								"Content-Type": "application/json",
								"X-CSRFToken": "{{ csrf_token() }}"
							},
							body: JSON.stringify({
								latitude: position.coords.latitude,
								longitude: position.coords.longitude
							})
						});
					},
					error => console.error("Geolocation error:", error)
					);
			}
		}

// Update every 60 seconds (tweak as needed)
setInterval(updateLocation, 60000);
updateLocation(); // Initial call
</script>
<script>
	const toggleBtn = document.getElementById("menu-toggle");
	const menu = document.getElementById("menu");

	toggleBtn.addEventListener("click", () => {
		menu.classList.toggle("hidden");
	});
</script>

</body>
</html>
